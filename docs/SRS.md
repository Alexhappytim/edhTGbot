# Требования к информационной системе проведения турниров MTG через Telegram-бот

## 1. Описание предметной области

**Magic: The Gathering (MTG)** — коллекционная карточная игра. Система поддерживает два формата:

- **Швейцарская система**: фиксированное число раундов, матчи Best of 3, первый раунд случайный, дальнейшие — по текущим результатам, очки 3/1/0 в зависимости от результата раунда, таблица и тай-брейкеры .
- **Казуальный формат с группами**: игроки сидят за столами по 4 человека и иногда хотят перемешивать эти столы для разнообразия.

Телеграм-бот устраняет ручные ошибки, обеспечивает удобный ввод результатов и прозрачную таблицу прямо в чате, поддерживает историю и уведомления игроков.

---

## 2. Назначение информационной системы и решаемые задачи

Система автоматизирует проведение MTG турниров через Telegram: создание, присоединение, раунды, ввод/редактирование результатов, уведомления и просмотр таблиц.

### Задачи, которые позволяет решить система:

### 2.1. Автоматизация турнирного процесса
- Удобное создание турниров
- Автоматическое составление пар/групп
- Автоподсчёт очков и тай-брейков (OMW/GW/OGW)

### 2.2. Удобство для игроков
- Присоединение и переподключение к турниру прямо в Telegram
- Ввод/редактирование результатов через бота
- Прозрачные пары/группы и уведомления соперникам

### 2.3. Уменьшение нагрузки на организатора
- Автоматизация расчётов и таблиц
- Валидации (только владелец может стартовать/редактировать/удалять игроков)
- Авто-уведомления игроков при старте раунда

### 2.4. Прозрачность
- Хранение действий и результатов
- Общедоступные таблицы и пары
- История подключённых турниров в сессии пользователя
---

## 3. Требования к информационной системе

### FR1. Регистрация и идентификация
- Система должна позволять пользователю автоматически идентифицироваться по его Telegram ID
- Система должна позволять пользователю изменить своё отображаемое имя (игровой ник)

### FR2. Создание и управление турнирами
- Система должна позволять создать турнир выбранного типа (SWISS или CASUAL)
- Для SWISS: задать название и лимит игроков; для CASUAL: название
- Создатель является владельцем и может управлять турниром

### FR3. Присоединение к турнирам
- Система должна позволять присоединиться к открытому турниру выбранного типа
- Система должна позволять владельцу добавлять временных игроков (без телеграма)
- Система должна позволять владельцу удалять участников

### FR4. Запуск турнира
- Только владелец может запустить SWISS турнир (первый раунд)
- Только владелец может стартовать следующий раунд; запуск возможен только если все матчи завершены и не превышен лимит раундов
- При старте раунда бот уведомляет каждого игрока о сопернике/bye
- После запуска регистрация запрещена

### FR5. Формирование пар раунда (SWISS)
- Система должна автоматически формировать пары по швейцарской системе, предотвращая повторные встречи
- Система должна назначать bye при нечётном количестве участников
- Система должна выдавать пары через бота (просмотр и уведомления)

### FR6. Ввод результатов матчей
- Система должна позволять участнику отправлять счёт BO3
- Система должна позволять владельцу редактировать результат
- Система должна автоматически пересчитывать очки и тай-брейкеры, обновляя таблицу после завершения раунда

### FR7. Просмотр турнирной таблицы
- Система должна позволять запросить таблицу; бот показывает очки, ранг и тай-брейкеры (OMW%, GW%, OGW%)
- Таблица доступна через inline-клавиатуру с навигацией

### FR8. Завершение турнира
- Система должна завершать турнир после последнего раунда и фиксировать итоговую таблицу
- Система должна позволять просмотреть итоговые результаты

### FR9. Казуальный формат (CASUAL)
- Система должна позволять владельцу отмечать готовность игроков, отмечать группы целиком и перемешивать готовых
- Система должна формировать группы/раунды по готовым игрокам
- Система должна позволять просматривать группы и списки готовых

### FR10. Управление сессиями и переключение турниров
- Система должна сохранять историю присоединённых турниров пользователя и текущий выбор
- Система должна позволять переключаться между турнирами из истории
- Система должна сохранять тип турнира при переключении

---

### 3.2. Нефункциональные требования

#### NFR1. Надёжность
- Сохранение данных турниров и пользовательских сессий
- Возможность восстановления состояния после перезапуска

#### NFR2. Производительность
- Формирование пар/групп ≤ 3 секунд
- Ответ бота ≤ 1 секунды для запросов кэшируемых данных (пары, таблица)

#### NFR3. Масштабируемость
- Поддержка нескольких турниров одновременно (разные типы)
- Работа с 64–128 участниками в швейцарке

#### NFR4. Юзабилити
- Все основные команды доступны через inline-кнопки/клавиатуру
- Сообщения редактируются вместо спама новыми, есть кнопка «Назад»

#### NFR5. Безопасность
- Управляющие действия (старт/след. раунд, кик, редактирование) доступны только владельцу турнира
- Все действия привязаны к Telegram ID
---

## 4. Модели основных прецедентов

### Перечень прецедентов (обновлено):
1. UC01 — Создать турнир (SWISS или CASUAL)  
2. UC02 — Присоединиться/переподключиться к турниру  
3. UC03 — Запустить швейцарский турнир (первый раунд)  
4. UC04 — Начать следующий швейцарский раунд  
5. UC05 — Получить пары (SWISS) или группы (CASUAL)  
6. UC06 — Ввести/отредактировать результат матча (SWISS)  
7. UC07 — Просмотреть турнирную таблицу (SWISS, с OMW/GW/OGW)  
8. UC08 — Управлять готовностью и reshuffle в CASUAL  
9. UC09 — Переключиться на ранее присоединённый турнир

---

## 4.1. UC01 — Создание турнира (SWISS или CASUAL)

**Актор:** Пользователь (Организатор)

**Цель:** Создать новый турнир.

**Предусловия:** Пользователь авторизован.

**Сценарий:**
1. Команда создания (кнопка/inline) с выбором типа: SWISS или CASUAL.
2. Для SWISS: ввод названия и лимита игроков; для CASUAL: ввод названия.
3. Система создаёт турнир, привязывает владельца.
4. Система подтверждает создание и сохраняет турнир в истории пользователя.

**Постусловие:** Турнир создан, тип зафиксирован, владелец назначен.

---

## 4.2. UC02 — Присоединение/переподключение

**Актор:** Пользователь

**Цель:** Присоединиться к турниру.

**Предусловия:** Турнир не запущен, пользователь авторизован.

**Сценарий:**
1. Команда/кнопка join с вводом ID, либо повторный join ранее посещённого турнира.
2. Система определяет тип турнира (SWISS/CASUAL) по ID.
3. Если игрок уже зарегистрирован, возвращается joined=false (200 OK) и турнир сохраняется в истории.
4. Если временный игрок, владелец может добавить без Telegram ID.
5. Система подтверждает и сохраняет текущий турнир в сессии.
---

## 4.3. UC03 — Запуск швейцарского турнира (первый раунд)

**Актор:** Организатор

**Цель:** Начать турнир.

**Сценарий:**
1. Владелец отправляет команду старта раунда.
2. Система проверяет статус регистрации и владельца.
3. Формируется первый раунд (рандомный), назначается bye если нужно.
4. Бот уведомляет каждого игрока о сопернике/bye.

---

## 4.4. UC04 — Начало следующего швейцарского раунда

**Сценарий:**
1. Владелец вызывает «Следующий раунд».
2. Система проверяет, что все матчи завершены и раунд не превышает лимит.
3. Формируются пары по швейцарке, bye при нечётном количестве.
4. Бот уведомляет игроков о соперниках/bye.

---

## 4.5. UC05 — Получение пар/групп

**Актор:** Участник/Организатор

**Цель:** Посмотреть текущие пары.

**Сценарий (SWISS):**
1. Команда/кнопка «Пары».
2. Бот показывает текущие пары (редактируемое сообщение).

**Сценарий (CASUAL):**
1. Команда/кнопка «Группы».
2. Бот показывает текущие группы.

---

## 4.6. UC06 — Ввод/редактирование результата матча (SWISS)

**Актор:** Участник / Организатор

**Цель:** Ввести или изменить результат.

**Сценарий:**
1. Участник выбирает матч в inline-меню и вводит счёт BO3 (валидация 2-0/2-1/1-2/0-2/1-1).
2. Система записывает результат; владелец может выбрать матч и отредактировать счёт.
3. При завершении всех матчей раунда обновляются очки 3/1/0 и тай-брейкеры, формируется готовность к следующему раунду.

---

## 4.7. UC07 — Просмотр турнирной таблицы (SWISS)

**Актор:** Любой пользователь

**Цель:** Посмотреть результаты.

**Сценарий:**
1. Кнопка/команда «Статистика/Стол».
2. Бот выводит очки, ранг, OMW%, GW%, OGW% (редактируемое сообщение с кнопкой «Назад»).

---

## 4.8. UC08 — Управление готовностью и reshuffle (CASUAL)

**Сценарий:**
1. Владелец отмечает готовность игрока/группы или всех, либо игрок сам отмечает готовность.
2. Владелец может снять готовность.
3. Владелец запускает start-round или reshuffle готовых; формируются группы.
4. Бот показывает группы и готовых игроков.

## 4.9. UC09 — Переключение турниров из истории

**Сценарий:**
1. Пользователь открывает «Переключиться на турнир» (inline-кнопка).
2. Выбирает турнир из сохранённой истории или вводит ID/тип вручную.
3. Сессия обновляется, показана основная клавиатура для выбранного турнира.
